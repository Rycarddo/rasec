generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String
  role          UserRole  @default(READONLY)
  isActive      Boolean   @default(true)
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  accounts      Account[]
  sessions      Session[]
}

model Session {
  id        String   @id @default(uuid())
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Account {
  id                    String    @id @default(uuid())
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Verification {
  id         String   @id @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
}

model Military {
  id                   String            @id @default(uuid())
  militaryRank         MilitaryRank
  fullName             String
  warName              String
  section              Section
  situation            MilitarySituation
  maintenance          Boolean
  identity             String            @unique
  saram                String            @unique
  cpf                  String            @unique
  lpna                 String            @unique
  phone                String            @unique
  email                String            @unique
  birthDateAt          DateTime
  graduatedAt          DateTime
  lastPromotedAt       DateTime
  pracaAt              DateTime
  presentationDate     DateTime
  htValidityAt         DateTime
  inspsauValidityAt    DateTime
  examiner             Boolean
  areaTimeAt           DateTime
  visible              Boolean           @default(true)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  operationalTests     OperationalTest[]
  qualifications       Qualification[]
  theoreticalTestDates TheoreticalTest[]

  @@index([section])
  @@index([militaryRank])
  @@index([situation])
  @@index([visible])
  @@index([htValidityAt])
  @@index([inspsauValidityAt])
}

model Qualification {
  id         String   @id @default(uuid())
  militaryId String
  name       String
  military   Military @relation(fields: [militaryId], references: [id], onDelete: Cascade)

  @@index([militaryId])
  @@index([name])
}

model OperationalTest {
  id         String   @id @default(uuid())
  militaryId String
  score      Decimal
  testAt     DateTime
  createdAt  DateTime @default(now())
  military   Military @relation(fields: [militaryId], references: [id], onDelete: Cascade)

  @@index([militaryId])
  @@index([testAt])
}

model TheoreticalTest {
  id         String   @id @default(uuid())
  militaryId String
  testAt     DateTime
  createdAt  DateTime @default(now())
  military   Military @relation(fields: [militaryId], references: [id], onDelete: Cascade)

  @@index([militaryId])
  @@index([testAt])
}

enum UserRole {
  ADMIN
  OPERATOR
  READONLY
}

enum Section {
  COM
  CIVA
  FIS
  OPG
  SAR
  DT
  DTCEA_BE
  DTCEA_BV
  DTCEA_PV
  DTCEA_GM
}

enum MilitarySituation {
  ESCALA
  EXPEDIENTE
  AFASTADO
}

enum MilitaryRank {
  Rank_SO
  Rank_1S
  Rank_2S
  Rank_3S
}
